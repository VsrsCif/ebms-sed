<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:composite="http://java.sun.com/jsf/composite"
      >

    <composite:interface>

    </composite:interface>

    <composite:implementation >
        <p:layout   widgetVar="InMailDataMain" style="min-width:400px;min-height:400px;height: 100%;width: 100%"  >
            <p:layoutUnit position="center" style="width:100%;height:100%;padding: 0px; margin: 0px" gutter="0" >
                <p:scrollPanel mode="native" style="width:100%;height:100%"> <!-- p:dataTable scrollable does not resize when toogled suth panel -->
                    <p:dataTable id="OutMailTable" 
                                 var="inMail"
                                 value="#{InMailDataView.mailList}" 
                                 selectionMode="single" 
                                 selection="#{InMailDataView.currentMail}" 
                                 rowKey="#{inMail.id}"
                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 rowsPerPageTemplate="25,50,100,200" 
                                 paginator="true" 
                                 rows="50" 
                                 lazy="true"
                                 style="padding: 0px; margin: 0px"
                                 scrollable="true" 
                                 scrollHeight="100%"
                                 
                                 
                                 >
                        <p:ajax event="rowSelect" listener="#{InMailDataView.onRowSelect}" 
                                update="forms:InMailPanel:InMailTab" />                        
                        <p:column width="60" headerText="No.">
                            <h:outputText value="#{InMailDataView.rowIndex(inMail) + 1}" />
                        </p:column>
                        <p:column width="60" headerText="Id" >
                            <h:outputText value="#{inMail.id}" />
                        </p:column>

                        <p:column width="15" style="background-color:#{InMailDataView.getStatusColor(inMail.status)}"
                                  headerText="St.">
                            <h:outputText value=" " />
                        </p:column>
                          <p:column width="100" headerText="Rec. date">
                              <h:outputText value="#{InMailDataView.formatDate(inMail.receivedDate)}" />
                        </p:column>

                        <p:column headerText="Sender">
                            <h:outputText value="#{inMail.senderName}" />
                        </p:column>

                        <p:column headerText="Receiver">
                            <h:outputText value="#{inMail.receiverName}" />
                        </p:column>
                        <p:column headerText="Service">
                            <h:outputText value="#{inMail.service}" />
                        </p:column>
                        <p:column headerText="Action">
                            <h:outputText value="#{inMail.action}" />
                        </p:column>
                    </p:dataTable>
                </p:scrollPanel>
            </p:layoutUnit>
            <p:layoutUnit  position="south" resizable="true" closable="true" collapsible="true"
                           size="200" minSize="40" maxSize="400" style="width:100%;height:100%;padding: 0px; margin: 0px"
                           gutter="0">
                <p:tabView id="InMailTab" style="height: 100%" activeIndex="#{InMailDataView.tabActiveIndex}">
                    <p:ajax event="tabChange" listener="#{InMailDataView.onTabChange}"/> 
                    <p:tab   id="InMailDataTab" title="Podatki">
                        <f:facet name="title">
                            <h:graphicImage value="resources/images/mail32.png" width="22" height="22" />
                            <h:outputText value="Podatki" />
                        </f:facet>

                        <p:outputPanel id="InMailData" >
                            <table style=" width: 100%" >
                                <tr>
                                    <td align="right" width="120">Id:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.id}"  style="width:100%;"  readonly='true' /></td>
                                    <td align="right" width="180">Receiver name:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.receiverName}"  style="width:100%;"  readonly='true' /></td>
                                    <td align="right" width="180">Receiver e-box:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.receiverEBox}"  style="width:100%;"  readonly='true' /></td>
                                    <td align="right" width="180">Submit date:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.submittedDate}"  style="width:100%;"  readonly='true' /></td>
                                </tr>
                                <tr>
                                    <td align="right">Sender id:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.senderMessageId}"  style="width:100%;"  readonly='true' /></td>
                                    <td align="right">Sender name:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.senderName}"  style="width:100%;"  readonly='true' /></td>
                                    <td align="right">Sender e-box:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.senderEBox}"  style="width:100%;"  readonly='true' /></td>
                                    <td align="right">Sent date:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.sentDate}"  style="width:100%;"  readonly='true' /></td>
                                </tr>
                                <tr>
                                    <td align="right">Service:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.service}" style="width:100%;"  readonly='true' /></td>
                                    <td align="right">Action:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.action}"  style="width:100%;"  readonly='true' /></td>
                                    <td align="right">Transaction:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.conversationId}"  style="width:100%;"  readonly='true' /></td>
                                    <td align="right">Received date:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.receivedDate}"  style="width:100%;"  readonly='true' /></td>
                                </tr>
                                <tr>
                                    <td align="right">Subject:</td> 
                                    <td align="left" colspan="5"><h:inputText value="#{InMailDataView.currentMail.subject}"  style="width:100%;"  readonly='true' /></td>                                    
                                    <td align="right">Delivered date:</td> 
                                    <td align="left"><h:inputText value="#{InMailDataView.currentMail.deliveredDate}" style="width:100%;"  readonly='true' /></td>
                                </tr>
                            </table>
                        </p:outputPanel>
                    </p:tab>
                    <p:tab >
                        <f:facet name="title">
                            <h:graphicImage value="resources/images/document22.png" width="22" height="22" />
                            <h:outputText value="Payloads" />
                        </f:facet>

                        <p:outputPanel id="InMailDocuments" style="text-align:center;">


                            <p:dataTable var="plpart" 
                                         value="#{InMailDataView.currentMail.MSHInPayload.MSHInParts}"
                                         scrollable="true"
                                     scrollHeight="135">
                                <p:column width="60" headerText="Id">
                                    <h:outputText value="#{plpart.id}" />
                                </p:column>
                                <p:column width="60" headerText="Download">
                                    <p:commandButton ajax="false" value="Download"
                                            onclick="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon-arrowthick-1-s">
                                        <p:fileDownload value="#{InMailDataView.getFile(plpart.id)}" />
                                    </p:commandButton>
                                </p:column>
                                <p:column headerText="Filename">
                                    <h:outputText value="#{plpart.filename}" />
                                </p:column>
                                <p:column headerText="Description">
                                    <h:outputText value="#{plpart.description}" />
                                </p:column>
                                <p:column headerText="MimeType">
                                    <h:outputText value="#{plpart.mimeType}" />
                                </p:column>

                            </p:dataTable>

                        </p:outputPanel>
                    </p:tab>
                    <p:tab >
                        <f:facet name="title">
                            <h:graphicImage value="resources/images/events22.png" width="22" height="22" />
                            <h:outputText value="Events" />                                 
                        </f:facet>
                        <p:outputPanel id="InMailEvents" style="text-align:center;">


                            <p:dataTable var="mailEvents" value="#{InMailDataView.mailEvents}">
                                <p:column width="60" headerText="Id">
                                    <h:outputText value="#{mailEvents.id}" />
                                </p:column>
                                <p:column headerText="Status" width="15" style="background-color:#{InMailDataView.getStatusColor(mailEvents.status)}" >
                                    <h:outputText value=" " />
                                </p:column>
                                <p:column headerText="Date">
                                    <h:outputText value="#{mailEvents.date}" />
                                </p:column>
                                <p:column headerText="Description">
                                    <h:outputText value="#{mailEvents.description}" />
                                </p:column>
                                <p:column headerText="UsersId">
                                    <h:outputText value="#{mailEvents.userId}" />
                                </p:column>

                            </p:dataTable>

                        </p:outputPanel>
                    </p:tab>
                </p:tabView>
            </p:layoutUnit>
        </p:layout>


    </composite:implementation>

</html>
